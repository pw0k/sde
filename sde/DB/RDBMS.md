### OLTP (Online Transaction Processing) / OLAP(Online Analytical Processing)

OLTP **системы** характеризуются большим количеством коротких транзакций, требующих высокой скорости обработки и надежности. OLAP **системы** предназначены для выполнения сложных аналитических запросов на больших объемах данных. 

### Рассмотрим представителей  

| Параметр               | PostgreSQL (OLTP)                   | [[ClickHouse]] (OLAP)                   |
| ---------------------- | ----------------------------------- | --------------------------------------- |
| **Тип хранения**       | Строковое (Row-oriented)            | Колоночное (Column-oriented)            |
| **Транзакции**         | Полная поддержка ACID               | Ограниченная поддержка транзакций       |
| **Запросы**            | CRUD операции, сложные транзакции   | Агрегации, аналитические запросы        |
| **Производительность** | Оптимизирован для операций записи   | Оптимизирован для операций чтения       |
| **Масштабирование**    | Вертикальное и горизонтальное       | Горизонтальное (кластеризация)          |
| **Применение**         | Банковские системы, e-commerce, CRM | BI, аналитика, обработка больших данных |

### ACID (Atomicity, Consistency, Isolation, Durability)

- **Atomicity (Атомарность)**: Транзакция выполняется полностью или не выполняется вовсе. Если какая-либо часть транзакции не проходит, все изменения откатываются.
    
- **Consistency (Согласованность)**: Транзакция переводит базу данных из одного согласованного состояния в другое, соблюдая все определенные правила целостности данных (constraints). На практике этот пункт обычно реализуется именно в приложении 
    
- **Isolation (Изоляция)**: Одновременные транзакции выполняются так, будто они работают последовательно, не влияя друг на друга. Это достигается через уровни изоляции транзакций (MVCC + isolation level)
    
- **Durability (Долговечность)**: После подтверждения транзакции ее результаты сохраняются даже при сбое системы. Это обеспечивается механизмом WAL.

### WAL (Write-Ahead Logging)
- **Журналирование**: Все изменения данных сначала записываются в WAL, прежде чем быть применены к основным файлам данных.
- **Синхронизация на диск**: PostgreSQL гарантирует, что записи WAL сброшены на диск при подтверждении транзакции (`COMMIT`).

**Также WAL используется для восстановлении:**
- **Crash Recovery (Восстановление после сбоя)**: При перезапуске после сбоя PostgreSQL воспроизводит журнал WAL, чтобы восстановить базу данных до консистентного состояния.
- **Point-in-Time Recovery (Восстановление до точки во времени)**: Позволяет восстановить базу данных до конкретного момента времени, используя архивные журналы WAL.

### [Уровни изоляции транзакций в PostgreSQL](transaction)